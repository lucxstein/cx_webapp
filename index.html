<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX Profit Center - Calculadora</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0?external=react"
        }
    }
    </script>

    <style>
        /* Animações personalizadas que o Tailwind padrão não tem */
        @keyframes shimmer {
            0% { transform: translateX(-150%) skewX(-12deg); }
            100% { transform: translateX(150%) skewX(-12deg); }
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          TrendingUp, 
          Users, 
          AlertCircle, 
          DollarSign, 
          Target, 
          PieChart, 
          ArrowRight,
          Briefcase,
          CheckCircle,
          BarChart3,
          MessageSquare,
          HelpCircle,
          Calculator,
          ListFilter,
          Infinity,
          BookOpen
        } from 'lucide-react';

        // Componentes de UI simplificados
        const Card = ({ children, className = "" }) => (
          <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${className}`}>
            {children}
          </div>
        );

        const Button = ({ onClick, children, variant = "primary", className = "", disabled = false }) => {
          const baseStyle = "px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed";
          const variants = {
            primary: "bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg",
            secondary: "bg-white text-slate-700 border border-slate-300 hover:bg-slate-50",
            success: "bg-emerald-600 text-white hover:bg-emerald-700 shadow-md",
            danger: "bg-red-50 text-red-600 hover:bg-red-100 border border-red-200",
            ai: "bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700 shadow-md"
          };
          return (
            <button onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`} disabled={disabled}>
              {children}
            </button>
          );
        };

        const Input = ({ label, value, onChange, type = "text", prefix, suffix, placeholder }) => (
          <div className="mb-4">
            <label className="block text-sm font-medium text-slate-700 mb-1">{label}</label>
            <div className="relative">
              {prefix && <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">{prefix}</span>}
              <input
                type={type}
                value={value}
                onChange={(e) => onChange(e.target.value)}
                className={`w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all ${prefix ? 'pl-8' : ''} ${suffix ? 'pr-8' : ''}`}
                placeholder={placeholder}
              />
              {suffix && <span className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">{suffix}</span>}
            </div>
          </div>
        );

        const StatCard = ({ title, value, subtext, icon: Icon, trend, trendLabel }) => (
          <Card className="p-6">
            <div className="flex justify-between items-start mb-4">
              <div className="p-2 bg-blue-50 rounded-lg">
                <Icon className="w-6 h-6 text-blue-600" />
              </div>
              {trend && (
                <div className="text-right">
                      <span className={`text-sm font-medium ${trend > 0 ? 'text-emerald-600' : 'text-red-600'}`}>
                    {trend > 0 ? '+' : ''}{trend}
                    </span>
                    {trendLabel && <div className="text-xs text-slate-400">{trendLabel}</div>}
                </div>
                
              )}
            </div>
            <h3 className="text-slate-500 text-sm font-medium mb-1">{title}</h3>
            <p className="text-2xl font-bold text-slate-800">{value}</p>
            {subtext && <p className="text-xs text-slate-400 mt-1">{subtext}</p>}
          </Card>
        );

        // Níveis de Risco para Dropdown
        const RISK_LEVELS = [
          { value: 5, label: "Baixo (5%)", desc: "Incômodo leve", color: "text-slate-600" },
          { value: 15, label: "Médio (15%)", desc: "Atrito considerável", color: "text-yellow-600" },
          { value: 30, label: "Alto (30%)", desc: "Alto risco de saída", color: "text-orange-600" },
          { value: 50, label: "Crítico (50%)", desc: "Bloqueador de uso", color: "text-red-600" },
        ];

        function App() {
          const [activeTab, setActiveTab] = useState('setup');
          
          // Estado para Tooltip Flutuante
          const [tooltip, setTooltip] = useState({ show: false, x: 0, y: 0, text: '', position: 'top' });

          // Estado Global
          const [metrics, setMetrics] = useState({
            totalCustomers: 5000,
            arpu: 150, // Receita média por usuário
            monthlyChurnRate: 2.5, // %
            ticketVolume: 1200,
          });

          const [painPoints, setPainPoints] = useState([
            { id: 1, name: "Dificuldade no Checkout", ticketVol: 150, churnRisk: 15, solved: false },
            { id: 2, name: "Erro na Exportação de Relatório", ticketVol: 80, churnRisk: 5, solved: false },
            { id: 3, name: "Lentidão no Carregamento", ticketVol: 300, churnRisk: 30, solved: false },
          ]);

          // Handler para mostrar tooltip inteligente
          const handleMouseEnter = (e, text) => {
            const rect = e.currentTarget.getBoundingClientRect();
            const spaceAbove = rect.top;
            // Se tiver menos de 100px acima, joga o tooltip para baixo
            const placeBelow = spaceAbove < 100;

            setTooltip({
              show: true,
              x: rect.left + rect.width / 2, // Centraliza horizontalmente
              y: placeBelow ? rect.bottom + 10 : rect.top - 10,
              text,
              position: placeBelow ? 'bottom' : 'top'
            });
          };

          const handleMouseLeave = () => {
            setTooltip({ ...tooltip, show: false });
          };

          // Cálculos Básicos
          const annualRevenue = metrics.totalCustomers * metrics.arpu * 12;
          const annualChurnLoss = (metrics.totalCustomers * (metrics.monthlyChurnRate / 100)) * metrics.arpu * 12;
          const customersLostPerMonth = Math.round(metrics.totalCustomers * (metrics.monthlyChurnRate / 100));
          
          // Cálculo LTV Atual
          const currentLTV = metrics.monthlyChurnRate > 0 ? metrics.arpu / (metrics.monthlyChurnRate / 100) : 0;
          const currentLifetimeMonths = metrics.monthlyChurnRate > 0 ? 1 / (metrics.monthlyChurnRate / 100) : 0;

          // Função auxiliar para formatar meses de vida (tratando Infinito)
          const formatLifetimeDisplay = (val) => {
            if (val === Infinity) return "∞";
            return formatNumber(val);
          };


          // Cálculos de Oportunidade e Simulação
          const calculateOpportunity = () => {
            let totalRevenueAtRisk = 0;
            let potentialSavings = 0;
            let ticketsEliminated = 0;
            let monthlyCustomersSaved = 0;

            painPoints.forEach(point => {
              // 1. Cálculo Direto: Volume da dor x Risco (Bottom-up)
              const directCustomersAtRisk = point.ticketVol * (point.churnRisk / 100);
              
              // 2. Cálculo Sistêmico: (Volume da Dor / Volume Total de Tickets) x Churn Total Atual (Top-down)
              const volumeShare = metrics.ticketVolume > 0 ? (point.ticketVol / metrics.ticketVolume) : 0;
              const systemicCustomersAtRisk = customersLostPerMonth * volumeShare * (point.churnRisk / 100);
              
              // Soma dos impactos
              const totalCustomersImpacted = directCustomersAtRisk + systemicCustomersAtRisk;
              const riskValue = totalCustomersImpacted * metrics.arpu * 12;
              
              if (!point.solved) {
                totalRevenueAtRisk += riskValue;
              } else {
                potentialSavings += riskValue; // Receita salva
                ticketsEliminated += parseFloat(point.ticketVol);
                monthlyCustomersSaved += totalCustomersImpacted;
              }
            });

            // Projeção do Novo Churn e Novo LTV
            const currentMonthlyLost = metrics.totalCustomers * (metrics.monthlyChurnRate / 100);
            const projectedMonthlyLost = Math.max(0, currentMonthlyLost - monthlyCustomersSaved);
            const projectedChurnRate = (projectedMonthlyLost / metrics.totalCustomers) * 100;
            
            let projectedLTV;
            let projectedLifetimeMonths;
            const maxPracticalLifetimeMonths = 240; // 20 anos como cap para o cálculo financeiro se churn for 0%.

            if (projectedChurnRate <= 0) {
                // Se o churn é zero ou negativo, tratamos como churn 0%
                // LTV e Lifetime são limitados pelo cap para fins práticos/financeiros, mas exibimos ∞ para meses
                projectedLifetimeMonths = Infinity; 
                // Usamos o cap de 20 anos (240 meses) para a projeção monetária
                projectedLTV = metrics.arpu * maxPracticalLifetimeMonths; 
            } else {
                projectedLTV = metrics.arpu / (projectedChurnRate / 100);
                projectedLifetimeMonths = 1 / (projectedChurnRate / 100);
            }

            return { 
              totalRevenueAtRisk, 
              potentialSavings, 
              ticketsEliminated,
              projectedChurnRate,
              projectedLTV,
              projectedLifetimeMonths,
              monthlyCustomersSaved
            };
          };

          const analysis = calculateOpportunity();

          // Formatadores
          const formatMoney = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(val);
          const formatNumber = (val) => new Intl.NumberFormat('pt-BR', { maximumFractionDigits: 1 }).format(val);

          // Renderização das Telas
          const renderSetup = () => (
            <div className="space-y-6 animate-in fade-in duration-500">
              <div className="grid md:grid-cols-2 gap-8">
                <div className="space-y-4">
                  <div className="flex items-center gap-2 mb-4">
                    <div className="p-2 bg-blue-100 rounded-lg"><Briefcase className="w-5 h-5 text-blue-600"/></div>
                    <h2 className="text-xl font-bold text-slate-800">Métricas de Negócio</h2>
                  </div>
                  <Card className="p-6 space-y-4">
                    <Input 
                      label="Base de Clientes Ativos" 
                      value={metrics.totalCustomers} 
                      onChange={v => setMetrics({...metrics, totalCustomers: v})}
                      type="number"
                    />
                    <Input 
                      label="ARPU (Receita Média por Usuário/Mês)" 
                      value={metrics.arpu} 
                      onChange={v => setMetrics({...metrics, arpu: v})}
                      prefix="R$"
                      type="number"
                    />
                    <div className="p-3 bg-blue-50 rounded-lg border border-blue-100 text-xs text-blue-800 flex gap-2 items-start -mt-2">
                        <HelpCircle className="w-3 h-3 shrink-0 mt-0.5" />
                        <span>
                            <b>Dica:</b> Para calcular o ARPU, divida a <b>Receita Mensal Total</b> pelo número de <b>Clientes Ativos</b>.
                        </span>
                    </div>
                    <Input 
                      label="Churn Rate Mensal Atual (%)" 
                      value={metrics.monthlyChurnRate} 
                      onChange={v => setMetrics({...metrics, monthlyChurnRate: v})}
                      suffix="%"
                      type="number"
                    />
                  </Card>
                  <div className="bg-slate-900 text-white p-6 rounded-xl mt-6 shadow-xl border border-slate-700">
                    <h3 className="text-sm font-medium text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                      <Calculator className="w-4 h-4"/> Impacto Financeiro Atual
                    </h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div>
                        <div className="text-3xl font-bold text-white">{formatMoney(annualChurnLoss)}</div>
                        <div className="text-sm text-slate-400 mt-2">
                          Receita anual perdida em Churn atualmente.
                        </div>
                      </div>
                      <div className="pt-4 border-t border-slate-700">
                        <div className="flex justify-between items-center mb-1">
                           <span className="text-slate-400 text-sm">LTV Atual Estimado</span>
                           <span className="text-xl font-bold text-white">{formatMoney(currentLTV)}</span>
                        </div>
                         <p className="text-xs text-slate-500">
                           Baseado em um tempo de vida médio de <b>{formatNumber(currentLifetimeMonths)} meses</b> (1 / Churn Rate).
                         </p>
                      </div>
                    </div>
                  </div>
                </div>
                <div className="space-y-4">
                   <div className="flex items-center gap-2 mb-4">
                    <div className="p-2 bg-indigo-100 rounded-lg"><MessageSquare className="w-5 h-5 text-indigo-600"/></div>
                    <h2 className="text-xl font-bold text-slate-800">Contexto Operacional</h2>
                  </div>
                  <Card className="p-6 space-y-4">
                    <Input 
                      label="Volume Mensal de Tickets" 
                      value={metrics.ticketVolume} 
                      onChange={v => setMetrics({...metrics, ticketVolume: v})}
                      type="number"
                    />
                     <div className="p-4 bg-slate-50 rounded-lg border border-slate-100 text-sm text-slate-500">
                      <p className="flex items-start gap-3">
                        <AlertCircle className="w-5 h-5 text-blue-500 shrink-0 mt-0.5" />
                        <span>
                          <b>Dica:</b> O "custo por ticket" não importa aqui. Vamos focar apenas em quanto dinheiro estamos perdendo porque o cliente teve uma experiência ruim (Churn).
                        </span>
                      </p>
                    </div>
                  </Card>
                </div>
              </div>
              <div className="flex justify-end">
                <Button onClick={() => setActiveTab('painPoints')}>
                  Próximo: Mapear Dores <ArrowRight className="w-4 h-4"/>
                </Button>
              </div>
            </div>
          );

          const renderPainPoints = () => {
            const totalMappedTickets = painPoints.reduce((acc, curr) => acc + (parseFloat(curr.ticketVol) || 0), 0);
            const coveragePercentage = metrics.ticketVolume > 0 ? Math.round((totalMappedTickets / metrics.ticketVolume) * 100) : 0;
            let progressColor = "bg-red-500";
            if (coveragePercentage > 40) progressColor = "bg-yellow-500";
            if (coveragePercentage > 80) progressColor = "bg-emerald-500";

            const addPoint = () => {
              const newId = painPoints.length + 1;
              setPainPoints([...painPoints, { id: newId, name: "Novo Problema", ticketVol: 0, churnRisk: 5, solved: false }]);
            };

            const updatePoint = (id, field, val) => {
              setPainPoints(painPoints.map(p => p.id === id ? { ...p, [field]: val } : p));
            };

            const deletePoint = (id) => {
              setPainPoints(painPoints.filter(p => p.id !== id));
            };

            return (
              <div className="space-y-6 animate-in fade-in duration-500 relative">
                <div className="flex justify-between items-end">
                  <div>
                    <h2 className="text-xl font-bold text-slate-800">Conexão Causa-Efeito</h2>
                    <p className="text-slate-500 text-sm mt-1">Quais problemas estão gerando chamados e fazendo clientes cancelarem?</p>
                  </div>
                  <Button onClick={addPoint} variant="secondary">+ Adicionar Dor</Button>
                </div>

                <Card className="p-4 bg-slate-50 border-slate-200 mt-4">
                  <div className="flex justify-between text-sm mb-2 font-medium text-slate-700">
                    <span className="flex items-center gap-2">
                      <ListFilter className="w-4 h-4 text-slate-400"/>
                      Cobertura de Tickets Mapeados
                    </span>
                    <span>{totalMappedTickets} de {metrics.ticketVolume} tickets ({coveragePercentage}%)</span>
                  </div>
                  <div className="w-full bg-slate-200 rounded-full h-2.5">
                    <div className={`h-2.5 rounded-full transition-all duration-500 ${progressColor}`} style={{ width: `${Math.min(coveragePercentage, 100)}%` }}></div>
                  </div>
                </Card>

                <div className="overflow-x-auto rounded-xl border border-slate-200 shadow-sm mt-6">
                  <table className="w-full text-left border-collapse bg-white">
                    <thead className="bg-slate-50 text-slate-600 text-xs uppercase font-semibold">
                      <tr>
                        <th className="p-4 border-b border-slate-200">Dor do Cliente (Motivo de Contato)</th>
                        <th className="p-4 border-b border-slate-200 w-32">Vol. Mensal</th>
                        <th className="p-4 border-b border-slate-200 w-[300px]">
                            <div className="flex items-center gap-1">
                                Impacto no Cliente
                                <div 
                                  className="cursor-help relative group"
                                  onMouseEnter={(e) => handleMouseEnter(e, "Estime a probabilidade deste problema fazer o cliente cancelar.")}
                                  onMouseLeave={handleMouseLeave}
                                >
                                    <HelpCircle className="w-4 h-4 text-slate-400" />
                                </div>
                            </div>
                        </th>
                        <th className="p-4 border-b border-slate-200 w-40">Receita em Risco (Ano)</th>
                        <th className="p-4 border-b border-slate-200 w-16"></th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100">
                      {painPoints.map((point) => {
                         const directCustomersAtRisk = point.ticketVol * (point.churnRisk / 100);
                         const volumeShare = metrics.ticketVolume > 0 ? (point.ticketVol / metrics.ticketVolume) : 0;
                         const systemicCustomersAtRisk = customersLostPerMonth * volumeShare * (point.churnRisk / 100);
                         const totalCustomersImpacted = directCustomersAtRisk + systemicCustomersAtRisk;
                         
                         const revenueAtRisk = totalCustomersImpacted * metrics.arpu * 12;
                         const riskLevel = RISK_LEVELS.find(r => r.value === parseInt(point.churnRisk)) || RISK_LEVELS[0];
                         const volPercentage = metrics.ticketVolume > 0 ? ((point.ticketVol / metrics.ticketVolume) * 100).toFixed(0) : 0;
                         
                         return (
                          <tr key={point.id} className="hover:bg-slate-50 group transition-colors">
                            <td className="p-3">
                              <input 
                                className="w-full bg-transparent font-medium text-slate-700 outline-none border-b border-transparent focus:border-blue-400"
                                value={point.name}
                                onChange={(e) => updatePoint(point.id, 'name', e.target.value)}
                              />
                            </td>
                            <td className="p-3">
                              <input 
                                type="number"
                                className="w-full bg-transparent text-slate-600 outline-none border-b border-transparent focus:border-blue-400"
                                value={point.ticketVol}
                                onChange={(e) => updatePoint(point.id, 'ticketVol', e.target.value)}
                              />
                              <div className="text-xs text-slate-400 mt-1 font-medium">{volPercentage}% do total</div>
                            </td>
                            <td className="p-3">
                              <select
                                className={`w-full bg-transparent outline-none border-b border-transparent focus:border-blue-400 cursor-pointer font-medium ${riskLevel.color}`}
                                value={point.churnRisk}
                                onChange={(e) => updatePoint(point.id, 'churnRisk', e.target.value)}
                              >
                                {RISK_LEVELS.map(level => (
                                    <option key={level.value} value={level.value} className="text-slate-700">
                                        {level.label} - {level.desc}
                                    </option>
                                ))}
                              </select>
                            </td>
                            <td className="p-3 font-semibold text-red-600">
                              {formatMoney(revenueAtRisk)}
                            </td>
                            <td className="p-3 text-center">
                              <button onClick={() => deletePoint(point.id)} className="text-slate-300 hover:text-red-500 transition-colors">
                                &times;
                              </button>
                            </td>
                          </tr>
                         );
                      })}
                    </tbody>
                  </table>
                </div>

                <div className="bg-slate-100 border border-slate-200 rounded-lg p-4 mt-6">
                   <div className="flex items-center gap-2 mb-2 font-semibold text-slate-700">
                     <BookOpen className="w-5 h-5 text-blue-600"/>
                     <span>Entenda a Receita em Risco</span>
                   </div>
                   <div className="text-sm text-slate-600 space-y-2">
                     <p>Nossa calculadora utiliza uma abordagem composta para estimar o impacto financeiro:</p>
                     <ul className="list-disc pl-5 space-y-1">
                       <li>
                         <strong>Impacto Direto:</strong> Considera os clientes que abrem tickets dessa dor e saem especificamente por causa dela.
                       </li>
                       <li>
                         <strong>Impacto Sistêmico:</strong> Considera o "ruído" que essa dor gera na operação. Se uma dor representa 30% dos seus chamados, ela contribui proporcionalmente para o churn estrutural da empresa.
                       </li>
                     </ul>
                     <p className="mt-2 pt-2 border-t border-slate-200 font-medium text-slate-800">
                       Fórmula: <code>(Impacto Direto + Impacto Sistêmico) × ARPU × 12 meses</code>
                     </p>
                     
                     <div className="mt-3 bg-white border border-slate-200 p-3 rounded text-xs text-slate-600">
                        <p className="font-bold text-slate-700 mb-1">Exemplo Prático:</p>
                        <p className="mb-1">Imagine uma dor com <strong>100 tickets</strong> e risco de <strong>20%</strong> (em uma empresa com 1.000 tickets totais e 50 cancelamentos/mês):</p>
                        <ul className="list-disc pl-4 space-y-1">
                            <li><strong>Direto:</strong> 100 × 20% = <strong>20 clientes</strong> em risco direto.</li>
                            <li><strong>Sistêmico:</strong> (10% do volume total × 20% risco) × 50 churn total = <strong>1 cliente</strong> extra pelo ruído gerado.</li>
                            <li><strong>Total:</strong> 21 clientes em risco × ARPU × 12 = <strong>Receita em Risco</strong>.</li>
                        </ul>
                     </div>
                   </div>
                </div>
                
                <div className="flex justify-end gap-3 mt-6">
                   <Button variant="secondary" onClick={() => setActiveTab('setup')}>Voltar</Button>
                   <Button onClick={() => setActiveTab('roi')}>Ir para Simulação <ArrowRight className="w-4 h-4"/></Button>
                </div>
              </div>
            );
          };

          const renderSimulation = () => {
            const toggleSolution = (id) => {
              setPainPoints(painPoints.map(p => p.id === id ? { ...p, solved: !p.solved } : p));
            };

            return (
              <div className="space-y-6 animate-in fade-in duration-500">
                <div className="grid lg:grid-cols-3 gap-6">
                  <div className="lg:col-span-2 space-y-4">
                    <h2 className="text-xl font-bold text-slate-800 mb-4">Simulador de Impacto</h2>
                    <p className="text-slate-500 mb-4">Selecione os problemas que você vai resolver. O sistema calculará o impacto na retenção e no LTV.</p>
                    
                    <div className="grid gap-3">
                      {painPoints.map(point => {
                         const directCustomersAtRisk = point.ticketVol * (point.churnRisk / 100);
                         const volumeShare = metrics.ticketVolume > 0 ? (point.ticketVol / metrics.ticketVolume) : 0;
                         const systemicCustomersAtRisk = customersLostPerMonth * volumeShare * (point.churnRisk / 100);
                         const totalCustomersImpacted = directCustomersAtRisk + systemicCustomersAtRisk;
                         
                         const totalImpact = totalCustomersImpacted * metrics.arpu * 12;
                         const volPercentage = metrics.ticketVolume > 0 ? ((point.ticketVol / metrics.ticketVolume) * 100).toFixed(0) : 0;
                         
                         return (
                          <div 
                            key={point.id} 
                            onClick={() => toggleSolution(point.id)}
                            className={`p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 flex justify-between items-center ${
                              point.solved 
                              ? 'border-emerald-500 bg-emerald-50' 
                              : 'border-slate-200 bg-white hover:border-blue-300'
                            }`}
                          >
                            <div className="flex items-center gap-4">
                              <div className={`w-6 h-6 rounded-full flex items-center justify-center border ${
                                point.solved ? 'bg-emerald-500 border-emerald-500' : 'bg-white border-slate-300'
                              }`}>
                                {point.solved && <CheckCircle className="w-4 h-4 text-white" />}
                              </div>
                              <div>
                                <h4 className="font-semibold text-slate-800">{point.name}</h4>
                                <div className="text-xs text-slate-500 mt-1 flex gap-2">
                                    <span>Vol: {point.ticketVol} ({volPercentage}%)</span>
                                    <span>•</span>
                                    <span>Risco Churn: {point.churnRisk}%</span>
                                </div>
                              </div>
                            </div>
                            <div className="text-right">
                              <div className="text-sm font-bold text-emerald-700">+{formatMoney(totalImpact)}/ano</div>
                              <div className="text-xs text-slate-400">Preservados</div>
                            </div>
                          </div>
                         );
                      })}
                    </div>

                    <div className="bg-slate-100 border border-slate-200 rounded-lg p-4 mt-8">
                        <div className="flex items-center gap-2 mb-2 font-semibold text-slate-700">
                          <BookOpen className="w-5 h-5 text-blue-600"/>
                          <span>Entenda a Projeção</span>
                        </div>
                        <div className="text-sm text-slate-600 space-y-2">
                          <p>
                            <strong>Receita Anual Recuperada:</strong> É a soma do valor financeiro de risco de todos os itens marcados como resolvidos acima.
                          </p>
                          <p>
                            <strong>Novo LTV Projetado:</strong> Recalculamos o Churn Rate projetado subtraindo os clientes salvos. Com o churn menor, a vida média do cliente aumenta (<code>1 / Novo Churn</code>), o que aumenta o valor total deixado por ele.
                          </p>
                          <p className="italic text-xs text-slate-500 mt-1">
                            Nota: Resolver problemas de alto volume (que representam uma grande % dos tickets totais) tem um efeito multiplicador na redução do churn sistêmico.
                          </p>
                        </div>
                    </div>
                  </div>

                  <div className="lg:col-span-1">
                    <div className="sticky top-6">
                      <Card className="bg-slate-900 text-white border-slate-800 p-6 shadow-xl">
                        <h3 className="text-lg font-bold mb-6 flex items-center gap-2">
                          <TrendingUp className="text-emerald-400"/> Projeção
                        </h3>
                        <div className="space-y-6">
                           <div>
                            <div className="text-slate-400 text-sm mb-1">Receita Anual Recuperada</div>
                            <div className="text-3xl font-bold text-emerald-400">{formatMoney(analysis.potentialSavings)}</div>
                          </div>
                          <div className="h-px bg-slate-700 my-4"></div>
                          <div>
                              <div className="text-slate-400 text-sm mb-1">Novo LTV Projetado</div>
                              <div className="text-2xl font-bold text-white">{formatMoney(analysis.projectedLTV)}</div>
                              <div className="text-xs text-emerald-400 mt-1 flex items-center gap-1">
                                <TrendingUp className="w-3 h-3"/>
                                +{formatMoney(analysis.projectedLTV - currentLTV)} vs Atual
                              </div>
                          </div>
                          <div>
                            <div className="text-slate-400 text-sm mb-1">Redução no Churn</div>
                            <div className="flex justify-between items-end">
                                <div className="text-sm line-through text-slate-500">{metrics.monthlyChurnRate}%</div>
                                <ArrowRight className="w-4 h-4 text-slate-500 mb-1"/>
                                <div className="text-xl font-bold text-emerald-400">{formatNumber(analysis.projectedChurnRate)}%</div>
                            </div>
                          </div>
                          <Button 
                            variant="primary" 
                            className="w-full justify-center mt-4" 
                            onClick={() => setActiveTab('dashboard')}
                          >
                            Ver Dashboard Executivo
                          </Button>
                        </div>
                      </Card>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const renderDashboard = () => (
            <div className="space-y-8 animate-in fade-in duration-500">
              <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                  <h2 className="text-2xl font-bold text-slate-900">CX Strategy Board</h2>
                  <p className="text-slate-500">Transformando Customer Experience em Motor de Receita</p>
                </div>
                <div className="flex gap-2">
                  <Button onClick={() => setActiveTab('setup')}>Recalcular</Button>
                </div>
              </div>

              <div className="grid md:grid-cols-3 gap-4">
                <StatCard 
                  title="Receita Recuperável" 
                  value={formatMoney(analysis.potentialSavings)} 
                  subtext="Anualizada (Churn Evitado)"
                  icon={DollarSign}
                />
                <StatCard 
                  title="Novo LTV Projetado" 
                  value={formatMoney(analysis.projectedLTV)}
                  subtext={`Aumento de ${formatMoney(analysis.projectedLTV - currentLTV)} por cliente`}
                  icon={TrendingUp}
                  trend={analysis.projectedLTV > currentLTV ? ((analysis.projectedLTV - currentLTV) / currentLTV * 100).toFixed(1) : 0}
                  trendLabel="%"
                />
                <StatCard 
                  title="Tickets Eliminados" 
                  value={formatNumber(analysis.ticketsEliminated * 12)}
                  subtext="Volume anual reduzido"
                  icon={MessageSquare}
                />
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <Card className="p-6">
                  <h3 className="font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <Infinity className="w-5 h-5 text-blue-600"/>
                    Impacto no LTV
                  </h3>
                  <div className="space-y-6">
                    <div className="relative pt-6 pb-2">
                      <div className="flex items-end gap-8 h-48 border-b border-slate-200 pl-4 pb-2">
                        {/* LTV Atual */}
                        <div className="w-32 relative group">
                          <div className="absolute bottom-full w-full text-center mb-2 font-bold text-slate-600">
                            {formatNumber(currentLifetimeMonths)} meses
                          </div>
                          <div className="h-32 bg-slate-200 rounded-t-lg w-full flex flex-col items-center justify-center text-sm">
                              <span className="text-slate-500 text-xs uppercase mb-1">LTV Atual</span>
                              <span className="font-bold text-slate-700">{formatMoney(currentLTV)}</span>
                          </div>
                        </div>
                        <div className="pb-16 text-slate-400">
                          <ArrowRight />
                        </div>
                        {/* LTV Projetado */}
                        <div className="w-32 relative group">
                          <div className="absolute bottom-full w-full text-center mb-2 font-bold text-emerald-600">
                            {formatLifetimeDisplay(analysis.projectedLifetimeMonths)} meses
                          </div>
                          <div className="h-40 bg-emerald-500 rounded-t-lg w-full relative overflow-hidden flex flex-col items-center justify-center text-sm text-white shadow-lg shadow-emerald-200">
                            <div className="absolute top-0 left-0 w-full h-full bg-white opacity-20 transform -skew-x-12 -translate-x-full animate-[shimmer_2s_infinite]"></div>
                            <span className="text-emerald-100 text-xs uppercase mb-1 relative z-10">LTV Projetado</span>
                            <span className="font-bold relative z-10">{formatMoney(analysis.projectedLTV)}</span>
                          </div>
                        </div>
                      </div>
                      <div className="p-4 bg-slate-50 rounded-lg mt-4 text-sm text-slate-600">
                          <p className="mb-2"><strong>Como calculamos isso?</strong></p>
                          <p>O tempo médio de permanência de um cliente é calculado como <code>1 / Churn Rate</code>.</p>
                          <p className="mt-2">Ao reduzir o churn de <b>{metrics.monthlyChurnRate}%</b> para <b>{formatNumber(analysis.projectedChurnRate)}%</b> resolvendo as dores selecionadas, estendemos a vida útil do cliente e aumentamos o valor total que ele deixa.</p>
                      </div>
                    </div>
                  </div>
                </Card>

                {/* Card Resumo Executivo (Fixo) */}
                <Card className="p-6 bg-slate-50 border-slate-200 flex flex-col">
                  <div className="flex justify-between items-start mb-4">
                    <h3 className="font-bold text-slate-800 flex items-center gap-2">
                        <Target className="w-5 h-5 text-red-500"/>
                        Resumo
                    </h3>
                  </div>
                  
                  <div className="flex-1">
                        <ul className="space-y-6">
                            <li className="flex gap-3 text-sm text-slate-700">
                            <CheckCircle className="w-6 h-6 text-emerald-500 shrink-0"/>
                            <span className="leading-relaxed">
                                Hoje, problemas de experiência custam à empresa <b>{formatMoney(annualChurnLoss)}</b> por ano em churn.
                            </span>
                            </li>
                            <li className="flex gap-3 text-sm text-slate-700">
                            <CheckCircle className="w-6 h-6 text-emerald-500 shrink-0"/>
                            <span className="leading-relaxed">
                                Selecionamos melhorias que protegem <b>{formatMoney(analysis.potentialSavings)}</b> dessa receita.
                            </span>
                            </li>
                            <li className="flex gap-3 text-sm text-slate-700">
                            <CheckCircle className="w-6 h-6 text-emerald-500 shrink-0"/>
                            <span className="leading-relaxed">
                                Além da receita imediata, aumentamos o valor do cliente (LTV) de <b>{formatMoney(currentLTV)}</b> para <b>{formatMoney(analysis.projectedLTV)}</b>, estendendo o ciclo de vida.
                            </span>
                            </li>
                        </ul>
                  </div>
                </Card>
              </div>
            </div>
          );

          return (
            <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-12">
              {/* Header */}
              <header className="bg-slate-900 text-white shadow-lg sticky top-0 z-50">
                <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center">
                      <DollarSign className="text-white font-bold w-5 h-5"/>
                    </div>
                    <h1 className="font-bold text-lg tracking-tight">CX Profit Center</h1>
                  </div>
                  <nav className="flex gap-1">
                    {[
                      { id: 'setup', label: '1. Diagnóstico', icon: Briefcase },
                      { id: 'painPoints', label: '2. Dores vs Receita', icon: AlertCircle },
                      { id: 'roi', label: '3. Simulação', icon: TrendingUp },
                      { id: 'dashboard', label: '4. Dashboard', icon: PieChart },
                    ].map(tab => (
                      <button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id)}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                          activeTab === tab.id 
                          ? 'bg-slate-800 text-white shadow-inner' 
                          : 'text-slate-400 hover:text-white hover:bg-slate-800'
                        }`}
                      >
                        <tab.icon className="w-4 h-4" />
                        <span className="hidden md:inline">{tab.label}</span>
                      </button>
                    ))}
                  </nav>
                </div>
              </header>

              {/* Main Content */}
              <main className="max-w-6xl mx-auto px-4 py-8">
                {activeTab === 'setup' && renderSetup()}
                {activeTab === 'painPoints' && renderPainPoints()}
                {activeTab === 'roi' && renderSimulation()}
                {activeTab === 'dashboard' && renderDashboard()}
              </main>

              {/* Renderização do Tooltip Global */}
              {tooltip.show && (
                <div 
                    className="fixed z-[100] px-3 py-2 bg-slate-900 text-white text-xs rounded shadow-xl max-w-xs text-center pointer-events-none transform -translate-x-1/2 transition-opacity duration-200"
                    style={{ 
                        left: tooltip.x, 
                        top: tooltip.y,
                        transform: `translate(-50%, ${tooltip.position === 'top' ? '-100%' : '0'})`
                    }}
                >
                    {tooltip.text}
                    <div 
                        className={`absolute left-1/2 -translate-x-1/2 border-4 border-transparent ${
                            tooltip.position === 'top' 
                            ? 'border-t-slate-900 -bottom-2' 
                            : 'border-b-slate-900 -top-2'
                        }`}
                    />
                </div>
              )}
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>